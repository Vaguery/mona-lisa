<html>

<head>
  <title>Drawing circles on an HTML5 Canvas based on JSON scripts</title>
  <script src="http://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
  <canvas id="pic" width="640" height="480" autofocus="true" style="border-style: solid;border-width: 1px;"></canvas>

  <button type="button" id="run">Random Script</button>

  <script type="text/javascript">
    // a Slather script is a list of tokens
    // all numbers are floats on [0.0,1.0]
    // - a number is pushed to the numbers stack
    // the instructions are:
    // - circle: takes 3 numbers for x, y, radius
    // - color: takes 4 numbers for r,g,b,alpha
    // an instruction only works if there are enough numbers on the stack, and pops them if so

    function random_script (len) {
      var choice;
      var script = "0.0";

      for (i = 0; i < len; i++) {
        choice = Math.floor((Math.random() * 20) + 1);
        switch (choice) {
          case 1:
          case 2:
          case 3:
          case 4:
            script = script + " circle";
            break;
          case 5:
            script = script + " color";
            break;
          default:
            script = script + " " + Math.random().toFixed(5);
        }
      }
      return script
    }

    function run_script (script,canvas) {
      var ctx = canvas.getContext('2d');
      var numbers = [];
      var tokens = script.split(" ");
      var w = canvas.width;
      var h = canvas.height;

      // ctx.globalCompositeOperation = 'difference';


      function setColor (r,g,b,alpha) {
        ctx.fillStyle = "rgba(" + Math.floor(r*256) + 
          ", " + Math.floor(g*256) + ", " + 
          Math.floor(b*256) + ", " + alpha + ")";
      };

      function makeCircle (x,y,r) {
        ctx.beginPath();
        ctx.arc(x*w, y*h, r*100, 0, 2 * Math.PI, false);
        ctx.closePath();
        ctx.fill();
      }

      jQuery.each(tokens, function( index, token ) {
        switch (token) {
          case "circle":
            if (numbers.length > 2) {
              var radius = numbers.pop();
              var y = numbers.pop();
              var x = numbers.pop();
              makeCircle(x,y,radius);
            };
            break;
          case "color":
            if (numbers.length > 3) {
              var alpha = numbers.pop();
              var b = numbers.pop();
              var g = numbers.pop();
              var r = numbers.pop();
              setColor(r,g,b,alpha);
            };
            break;
          default:
            numbers.push( parseFloat(token) );
        }
      });
    
      // alert("Number stack:" + numbers);
    }

  </script>


  <script type="text/javascript">
    $( document ).ready(function() {
      $( "#run" ).bind( "click", function( event ) {        
        var script = random_script(1000);
        var canvas = document.getElementById('pic');
        run_script(script,canvas);
      });
    });
  </script>
</body>
</html>